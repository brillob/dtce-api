@model List<Dtce.WebClient.Models.JobHistory>
@{
    ViewData["Title"] = "Job History";
    Layout = "_Layout";
}

<div class="container" style="max-width: 1200px; margin: 40px auto; padding: 0 20px;">
    <div class="card" style="background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 30px;">
        <h2 style="color: #333; font-weight: bold; margin-bottom: 30px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
            Job History
        </h2>

        @if (Model == null || !Model.Any())
        {
            <div style="text-align: center; padding: 40px; color: #999;">
                <p style="font-size: 16px; margin: 0;">No job history found. Submit a document to get started!</p>
            </div>
        }
        else
        {
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                    <thead>
                        <tr style="border-bottom: 2px solid #ddd; background: #f8f9fa;">
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Submitted</th>
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Job ID</th>
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Document</th>
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Status</th>
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #333;">Results</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var job in Model)
                        {
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; color: #666;">
                                    <div style="font-size: 13px;">@job.SubmittedAt.ToString("MMM dd, yyyy")</div>
                                    <div style="font-size: 12px; color: #999;">@job.SubmittedAt.ToString("HH:mm:ss")</div>
                                </td>
                                <td style="padding: 12px;">
                                    <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; font-size: 12px; color: #666;">
                                        @job.JobId.Substring(0, 8)...
                                    </code>
                                </td>
                                <td style="padding: 12px; color: #666;">
                                    @if (job.InputType == "file" && !string.IsNullOrEmpty(job.FileName))
                                    {
                                        <span style="font-size: 14px;">üìÑ @job.FileName</span>
                                    }
                                    else if (job.InputType == "url" && !string.IsNullOrEmpty(job.DocumentUrl))
                                    {
                                        <a href="@job.DocumentUrl" target="_blank" style="color: #007bff; text-decoration: none; font-size: 14px;">
                                            üîó @(job.DocumentUrl.Length > 50 ? job.DocumentUrl.Substring(0, 50) + "..." : job.DocumentUrl)
                                        </a>
                                    }
                                    else
                                    {
                                        <span style="font-size: 14px; color: #999;">N/A</span>
                                    }
                                </td>
                                <td style="padding: 12px;">
                                    @{
                                        var statusColor = job.Status switch
                                        {
                                            "Complete" => "#28a745",
                                            "Error" or "Failed" => "#dc3545",
                                            "Pending" => "#ffc107",
                                            _ => "#17a2b8"
                                        };
                                        var statusBg = job.Status switch
                                        {
                                            "Complete" => "#d4edda",
                                            "Error" or "Failed" => "#f8d7da",
                                            "Pending" => "#fff3cd",
                                            _ => "#d1ecf1"
                                        };
                                    }
                                    <span style="background: @statusBg; color: @statusColor; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; display: inline-block;">
                                        @job.Status
                                    </span>
                                    @if (!string.IsNullOrEmpty(job.StatusMessage))
                                    {
                                        <div style="font-size: 11px; color: #999; margin-top: 4px;">@job.StatusMessage</div>
                                    }
                                </td>
                                <td style="padding: 12px;">
                                    @if (job.Status == "Complete" && (!string.IsNullOrEmpty(job.TemplateJsonUrl) || !string.IsNullOrEmpty(job.ContextJsonUrl)))
                                    {
                                        <div style="display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column;">
                                            @if (!string.IsNullOrEmpty(job.TemplateJsonUrl))
                                            {
                                                <div style="display: flex; gap: 4px;">
                                                    <a href="@job.TemplateJsonUrl" target="_blank" 
                                                       style="background: #007bff; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px; display: inline-block;">
                                                        üìÑ View template.json
                                                    </a>
                                                    <a href="@(job.TemplateJsonUrl + (job.TemplateJsonUrl.Contains("?") ? "&" : "?") + "download=true")" 
                                                       style="background: #6c757d; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px; display: inline-block;">
                                                        ‚¨á Download
                                                    </a>
                                                </div>
                                            }
                                            @if (!string.IsNullOrEmpty(job.ContextJsonUrl))
                                            {
                                                <div style="display: flex; gap: 4px;">
                                                    <a href="@job.ContextJsonUrl" target="_blank" 
                                                       style="background: #28a745; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px; display: inline-block;">
                                                        üìÑ View context.json
                                                    </a>
                                                    <a href="@(job.ContextJsonUrl + (job.ContextJsonUrl.Contains("?") ? "&" : "?") + "download=true")" 
                                                       style="background: #6c757d; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px; display: inline-block;">
                                                        ‚¨á Download
                                                    </a>
                                                </div>
                                            }
                                        </div>
                                    }
                                    else if (job.Status == "Error" || job.Status == "Failed")
                                    {
                                        <span style="color: #dc3545; font-size: 12px;">‚ùå Failed</span>
                                    }
                                    else
                                    {
                                        <span style="color: #999; font-size: 12px;">Processing...</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; color: #999; font-size: 12px; text-align: center;">
                Showing @Model.Count job(s)
            </div>
        }
    </div>
</div>

